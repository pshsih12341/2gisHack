# Геолокация в приложении

## Обзор

Приложение автоматически запрашивает доступ к геолокации пользователя при загрузке страницы для предоставления персонализированных услуг и отображения карты с текущим местоположением.

## Функциональность

### Автоматический запрос геолокации

- **При загрузке страницы** - автоматически показывается диалог запроса разрешения
- **Пользовательский выбор** - пользователь может разрешить или отказаться
- **Повторный запрос** - возможность запросить геолокацию повторно

### Интеграция с картой

- **Центрирование карты** - карта автоматически центрируется на местоположении пользователя
- **Увеличение масштаба** - при получении геолокации масштаб увеличивается до 15
- **Fallback** - если геолокация недоступна, карта показывает Москву

## Компоненты

### useGeolocation Hook

```javascript
const {
  location, // {latitude, longitude, accuracy, timestamp}
  error, // сообщение об ошибке
  isLoading, // состояние загрузки
  getCurrentPosition, // функция для запроса геолокации
  watchPosition, // функция для отслеживания изменений
  clearWatch, // функция для остановки отслеживания
} = useGeolocation();
```

**Опции по умолчанию:**

- `enableHighAccuracy: true` - высокая точность
- `timeout: 10000` - таймаут 10 секунд
- `maximumAge: 300000` - кэш на 5 минут

### GeolocationPrompt Component

Модальное окно для запроса разрешения на геолокацию:

- **Доступный дизайн** - поддержка скринридеров
- **Понятные кнопки** - "Разрешить" и "Отказаться"
- **Информативность** - объяснение зачем нужна геолокация
- **Мобильная оптимизация** - адаптирован под мобильные устройства

## Обработка ошибок

### Типы ошибок

1. **PERMISSION_DENIED** - пользователь запретил доступ
2. **POSITION_UNAVAILABLE** - местоположение недоступно
3. **TIMEOUT** - время ожидания истекло
4. **Неизвестная ошибка** - другие проблемы

### Пользовательские сообщения

- **Понятные описания** - объяснение что пошло не так
- **Рекомендации** - как исправить проблему
- **Визуальные индикаторы** - цветовая кодировка ошибок

## Безопасность и приватность

### Сбор данных

- **Минимальные данные** - только координаты и точность
- **Локальное хранение** - данные не передаются на сервер
- **Временное хранение** - данные не сохраняются постоянно

### Разрешения

- **Явное согласие** - пользователь должен явно разрешить
- **Возможность отзыва** - можно отозвать разрешение
- **Прозрачность** - понятно зачем нужна геолокация

## Настройки браузера

### Chrome/Edge

1. Настройки → Конфиденциальность и безопасность
2. Разрешения сайта → Местоположение
3. Выбрать сайт и настроить разрешения

### Safari

1. Настройки → Конфиденциальность
2. Службы геолокации
3. Настроить разрешения для сайта

### Firefox

1. Настройки → Конфиденциальность и безопасность
2. Разрешения → Местоположение
3. Управление исключениями

## Тестирование

### Локальное тестирование

1. **Откройте DevTools** (F12)
2. **Перейдите в Console** - посмотрите логи геолокации
3. **Перейдите в Application** → Permissions → Location
4. **Измените разрешения** для тестирования разных сценариев

### Эмуляция геолокации

1. **Chrome DevTools** → Console
2. **Выполните команду:**
   ```javascript
   navigator.geolocation.getCurrentPosition = (success) => {
     success({
       coords: {
         latitude: 55.7558,
         longitude: 37.6176,
         accuracy: 10,
       },
       timestamp: Date.now(),
     });
   };
   ```

### Тестирование ошибок

1. **Запретить геолокацию** в настройках браузера
2. **Отключить GPS** на мобильном устройстве
3. **Изменить часовой пояс** для тестирования таймаутов

## Производительность

### Оптимизации

- **Кэширование** - геолокация кэшируется на 5 минут
- **Ленивая загрузка** - геолокация запрашивается только при необходимости
- **Обработка ошибок** - graceful degradation при недоступности

### Мониторинг

- **Console логи** - отслеживание состояния геолокации
- **Метрики точности** - отображение точности определения
- **Время отклика** - мониторинг производительности

## Доступность

### Поддержка скринридеров

- **ARIA атрибуты** - правильные роли и метки
- **Семантическая разметка** - понятная структура
- **Клавиатурная навигация** - управление с клавиатуры

### Альтернативы

- **Ручной ввод** - возможность ввести адрес вручную
- **Поиск по карте** - поиск местоположения на карте
- **Сохраненные места** - быстрый доступ к избранным местам

## Полезные ресурсы

- [MDN Geolocation API](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API)
- [W3C Geolocation Specification](https://www.w3.org/TR/geolocation-API/)
- [Google Maps Geolocation](https://developers.google.com/maps/documentation/geolocation)
- [2GIS API Documentation](https://docs.2gis.com/)

## Поддержка

Если у вас возникли проблемы с геолокацией:

1. **Проверьте настройки браузера**
2. **Убедитесь в наличии GPS** (для мобильных устройств)
3. **Проверьте подключение к интернету**
4. **Обратитесь в поддержку** через GitHub Issues
